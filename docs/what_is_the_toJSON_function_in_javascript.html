<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>【翻译】JavaScript 中的 toJSON() 函数</title>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f09916983501146ea63fd65182c463e6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
</head>
<body>
<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px; color: black; padding: 0 10px; line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; word-break: break-word; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; margin-top: -10px;"><h1 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 24px;"><span class="prefix" style="display: none;"></span><span class="content">JavaScript 中的 <code>toJSON()</code> 函数</span><span class="suffix"></span></h1>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">在 JavaScript 中，<a href="/the-80-20-guide-to-json-stringify-in-javascript" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">JSON.stringify()</code> 函数</a> 在要被序列化的对象中查找名为 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON</code> 的函数。如果对象具有 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 函数，则 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">JSON.stringify()</code> 调用 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code>，并序列化来自  <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 的返回值。</p>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">例如，以下脚本打印与 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">JSON.stringify({ answer: 42 })</code> 相同的内容。</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;json&nbsp;=&nbsp;<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">JSON</span>.stringify({<br>&nbsp;&nbsp;<span class="hljs-attr" style="line-height: 26px;">answer</span>:&nbsp;{&nbsp;<span class="hljs-attr" style="line-height: 26px;">toJSON</span>:&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-params" style="line-height: 26px;">()</span>&nbsp;=&gt;</span>&nbsp;<span class="hljs-number" style="line-height: 26px;">42</span>&nbsp;}<br>});<br><br><span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">console</span>.log(json);&nbsp;<span class="hljs-comment" style="color: #75715e; line-height: 26px;">//&nbsp;{"answer":42}</span><br></code></pre>
  <h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px;"><span class="prefix" style="display: none;"></span><span class="content">在 <a href="https://masteringjs.io/tutorials/fundamentals/class" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">ES6 Classes</a> 中</span><span class="suffix"></span></h2>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 函数可用于确保 ES6 类正确序列化。 例如，假设有一个自定义 JavaScript Error 类。</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-class" style="line-height: 26px;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">class</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">HTTPError</span>&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">extends</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">Error</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">constructor</span>(message,&nbsp;status)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">super</span>(message);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;=&nbsp;status;<br>&nbsp;&nbsp;}<br>}<br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">默认情况下，JavaScript 不支持序列化错误对象。下面的脚本会打印出 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">{"status":404}</code>，而不会打印 error 对象的 message，或者栈跟踪信息。</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-class" style="line-height: 26px;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">class</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">HTTPError</span>&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">extends</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">Error</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">constructor</span>(message,&nbsp;status)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">super</span>(message);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;=&nbsp;status;<br>&nbsp;&nbsp;}<br>}<br><br><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;e&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">new</span>&nbsp;HTTPError(<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'Fail'</span>,&nbsp;<span class="hljs-number" style="line-height: 26px;">404</span>);<br><span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">console</span>.log(<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">JSON</span>.stringify(e));&nbsp;<span class="hljs-comment" style="color: #75715e; line-height: 26px;">//&nbsp;{"status":404}</span><br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">但是，如果在 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">HTTPError</code> 类中添加 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 方法，则可以配置 JavaScript 如何序列化 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">HTTPError</code> 实例。</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-class" style="line-height: 26px;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">class</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">HTTPError</span>&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">extends</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">Error</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">constructor</span>(message,&nbsp;status)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">super</span>(message);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;=&nbsp;status;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;toJSON()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">return</span>&nbsp;{&nbsp;<span class="hljs-attr" style="line-height: 26px;">message</span>:&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.message,&nbsp;<span class="hljs-attr" style="line-height: 26px;">status</span>:&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;};<br>&nbsp;&nbsp;}<br>}<br><br><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;e&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">new</span>&nbsp;HTTPError(<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'Fail'</span>,&nbsp;<span class="hljs-number" style="line-height: 26px;">404</span>);<br><span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">console</span>.log(<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">JSON</span>.stringify(e));&nbsp;<span class="hljs-comment" style="color: #75715e; line-height: 26px;">//&nbsp;{"message":"Fail","status":404}</span><br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">如果将 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">NODE_ENV</code> 设置成 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">development</code>，甚至可以设想并让 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 序列化栈跟踪信息。</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-class" style="line-height: 26px;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">class</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">HTTPError</span>&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">extends</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">Error</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">constructor</span>(message,&nbsp;status)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">super</span>(message);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;=&nbsp;status;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;toJSON()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;ret&nbsp;=&nbsp;{&nbsp;<span class="hljs-attr" style="line-height: 26px;">message</span>:&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.message,&nbsp;<span class="hljs-attr" style="line-height: 26px;">status</span>:&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">if</span>&nbsp;(process.env.NODE_ENV&nbsp;===&nbsp;<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'development'</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret.stack&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.stack;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">return</span>&nbsp;ret;<br>&nbsp;&nbsp;}<br>}<br><br><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;e&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">new</span>&nbsp;HTTPError(<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'Fail'</span>,&nbsp;<span class="hljs-number" style="line-height: 26px;">404</span>);<br><span class="hljs-comment" style="color: #75715e; line-height: 26px;">//&nbsp;{"message":"Fail","status":404,"stack":"Error:&nbsp;Fail\n&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;...</span><br><span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">console</span>.log(<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">JSON</span>.stringify(e));<br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 的好处是，JavaScript 帮你处理了递归，因此它仍然可以正确地序列化深度嵌套的 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">HTTPError</code> 实例和 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">HTTPError</code> 实例数组。</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-class" style="line-height: 26px;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">class</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">HTTPError</span>&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">extends</span>&nbsp;<span class="hljs-title" style="font-weight: bold; color: white; line-height: 26px;">Error</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">constructor</span>(message,&nbsp;status)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">super</span>(message);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;=&nbsp;status;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;toJSON()&nbsp;{&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">return</span>&nbsp;{&nbsp;<span class="hljs-attr" style="line-height: 26px;">message</span>:&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.message,&nbsp;<span class="hljs-attr" style="line-height: 26px;">status</span>:&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.status&nbsp;};<br>&nbsp;&nbsp;}<br>}<br><br><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;e&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">new</span>&nbsp;HTTPError(<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'Fail'</span>,&nbsp;<span class="hljs-number" style="line-height: 26px;">404</span>);<br><span class="hljs-comment" style="color: #75715e; line-height: 26px;">//&nbsp;{"nested":{"message":"Fail","status":404},"arr":[{"message":"Fail","status":404}]}</span><br><span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">console</span>.log(<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">JSON</span>.stringify({<br>&nbsp;&nbsp;<span class="hljs-attr" style="line-height: 26px;">nested</span>:&nbsp;e,<br>&nbsp;&nbsp;<span class="hljs-attr" style="line-height: 26px;">arr</span>:&nbsp;[e]<br>}));<br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">许多库和框架都在幕后用到 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">JSON.stringify()</code>。 例如，<a href="https://masteringjs.io/tutorials/express/json" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">Express 的 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">res.json()</code> 函数</a> 和 <a href="https://masteringjs.io/tutorials/axios/post" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">Axios POST 请求</a> 使用 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">JSON.stringify()</code> 来将对象转换为 JSON。 因此，自定义 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 函数也可以与这些模块一起使用。</p>
  <h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px;"><span class="prefix" style="display: none;"></span><span class="content">标准之外的 <code>toJSON()</code></span><span class="suffix"></span></h2>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">许多 Node.js 库和框架都使用 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 来确保 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">JSON.stringify()</code> 可以将复杂对象序列化为有意义的对象。例如，<a href="/formatting-javascript-dates-with-moment-js.html" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">Moment.js</a> 对象具有一个简单好用的 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 函数，如下所示：</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">function</span>&nbsp;<span class="hljs-title" style="color: #a6e22e; font-weight: bold; line-height: 26px;">toJSON</span>&nbsp;(<span class="hljs-params" style="line-height: 26px;"></span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span class="hljs-comment" style="color: #75715e; line-height: 26px;">//&nbsp;JSON.stringify(new&nbsp;Date(NaN))&nbsp;===&nbsp;'null'</span><br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">return</span>&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.isValid()&nbsp;?&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.toISOString()&nbsp;:&nbsp;<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'null'</span>;<br>}<br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">你可以尝试执行以下：</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;moment&nbsp;=&nbsp;<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">require</span>(<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'moment'</span>);<br><span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">console</span>.log(moment(<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'2019-06-01'</span>).toJSON.toString());<br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;"><a href="/an-overview-of-buffers-in-node-js.html#working-with-buffers" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">Node.js buffers</a> 也有一个 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 函数。</p>
  <pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px;"><code class="hljs" style="overflow-x: auto; padding: 16px; background: #272822; color: #ddd; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; border-radius: 0px; font-size: 12px; -webkit-overflow-scrolling: touch;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;buf&nbsp;=&nbsp;Buffer.from(<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'abc'</span>);<br><span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">console</span>.log(buf.toJSON.toString());<br><br><span class="hljs-comment" style="color: #75715e; line-height: 26px;">//&nbsp;打印：</span><br><span class="hljs-function" style="line-height: 26px;"><span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">function</span>&nbsp;<span class="hljs-title" style="color: #a6e22e; font-weight: bold; line-height: 26px;">toJSON</span>(<span class="hljs-params" style="line-height: 26px;"></span>)&nbsp;</span>{<br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">if</span>&nbsp;(<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.length&nbsp;&gt;&nbsp;<span class="hljs-number" style="line-height: 26px;">0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">const</span>&nbsp;data&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">new</span>&nbsp;<span class="hljs-built_in" style="color: #a6e22e; line-height: 26px;">Array</span>(<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.length);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">for</span>&nbsp;(<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">var</span>&nbsp;i&nbsp;=&nbsp;<span class="hljs-number" style="line-height: 26px;">0</span>;&nbsp;i&nbsp;&lt;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>.length;&nbsp;++i)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data[i]&nbsp;=&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">this</span>[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">return</span>&nbsp;{&nbsp;<span class="hljs-attr" style="line-height: 26px;">type</span>:&nbsp;<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'Buffer'</span>,&nbsp;data&nbsp;};<br>&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #f92672; font-weight: bold; line-height: 26px;">return</span>&nbsp;{&nbsp;<span class="hljs-attr" style="line-height: 26px;">type</span>:&nbsp;<span class="hljs-string" style="color: #a6e22e; line-height: 26px;">'Buffer'</span>,&nbsp;<span class="hljs-attr" style="line-height: 26px;">data</span>:&nbsp;[]&nbsp;};<br>&nbsp;&nbsp;}<br>}<br></code></pre>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;"><a href="https://mongoosejs.com" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;">Mongoose</a> 文档还具有 <a href="https://mongoosejs.com/docs/api/document.html#document_Document-toJSON" style="text-decoration: none; color: #1e6bb8; word-wrap: break-word; font-weight: bold; border-bottom: 1px solid #1e6bb8;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code></a> 函数，以确保 Mongoose 文档的内部状态不会出现在 <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">JSON.stringify()</code> 输出中。</p>
  <h2 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 22px;"><span class="prefix" style="display: none;"></span><span class="content">继续</span><span class="suffix"></span></h2>
  <p data-tool="mdnice编辑器" style="font-size: 16px; padding-top: 8px; padding-bottom: 8px; margin: 0; line-height: 26px; color: black;">在 JavaScript 中构建类时，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 函数是重要的工具。通过这种方式，可以控制 JavaScript 如何将类序列化为 JSON。<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; color: #1e6bb8; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all;">toJSON()</code> 函数可以帮助你解决许多问题，例如，可以用于确保应用程序中的date 对象或者 Node.js buffer 对象以正确格式进行序列化。所以下次编写 ES6 类时不妨一试。</p>
</section>
</body>
</html>
